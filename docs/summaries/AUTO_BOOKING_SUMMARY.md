# è‡ªåŠ¨æŠ¢ç¥¨ç³»ç»Ÿå®æ–½æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æˆåŠŸå®ç°äº† SJTU ä½“è‚²é¢„è®¢ç³»ç»Ÿçš„è‡ªåŠ¨æŠ¢ç¥¨åŠŸèƒ½ï¼Œæ¯å¤©ä¸­åˆ12ç‚¹å‡†æ—¶å¼€å§‹æŠ¢ä¸ƒå¤©åçš„åœºåœ°ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜ç²¾åº¦ã€é«˜æ•ˆç‡çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚

## âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ç²¾ç¡®æ—¶é—´æ§åˆ¶
- âœ… **12:00:00å‡†æ—¶å¯åŠ¨**: æ¯«ç§’çº§ç²¾åº¦çš„æ—¶é—´æ§åˆ¶
- âœ… **7å¤©åç›®æ ‡**: è‡ªåŠ¨è®¡ç®—ç›®æ ‡æ—¥æœŸ
- âœ… **æ—¶é—´åŒæ­¥**: ç¡®ä¿ç³»ç»Ÿæ—¶é—´å‡†ç¡®æ€§
- âœ… **è°ƒåº¦å™¨**: æŒç»­è¿è¡Œçš„è°ƒåº¦ç³»ç»Ÿ

### 2. æ™ºèƒ½æŠ¢ç¥¨ç­–ç•¥
- âœ… **ä¼˜å…ˆçº§æ’åº**: æŒ‰é…ç½®çš„ä¼˜å…ˆçº§é¡ºåºå°è¯•
- âœ… **æ—¶é—´æ®µåå¥½**: ä¼˜å…ˆé€‰æ‹©é…ç½®çš„æ—¶é—´æ®µ
- âœ… **å¿«é€Ÿé¢„è®¢**: æ¯«ç§’çº§å“åº”æ—¶é—´
- âœ… **é‡è¯•æœºåˆ¶**: æ¯ä¸ªç›®æ ‡æœ€å¤šå°è¯•3æ¬¡

### 3. å¤šç›®æ ‡ç®¡ç†
- âœ… **é…ç½®ç®¡ç†**: æ”¯æŒå¤šä¸ªåœºé¦†çš„é…ç½®
- âœ… **ä¼˜å…ˆçº§æ§åˆ¶**: çµæ´»çš„ä¼˜å…ˆçº§è®¾ç½®
- âœ… **å¯ç”¨/ç¦ç”¨**: å¯æ§åˆ¶æ¯ä¸ªç›®æ ‡çš„å¯ç”¨çŠ¶æ€
- âœ… **åŠ¨æ€æ›´æ–°**: æ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°

### 4. ç»“æœè¿½è¸ª
- âœ… **å†å²è®°å½•**: å®Œæ•´çš„æŠ¢ç¥¨å†å²è®°å½•
- âœ… **ç»Ÿè®¡åˆ†æ**: æˆåŠŸç‡å’Œå¤±è´¥åŸå› åˆ†æ
- âœ… **æ•°æ®åº“å­˜å‚¨**: æŒä¹…åŒ–å­˜å‚¨æ‰€æœ‰ç»“æœ
- âœ… **å®æ—¶ç›‘æ§**: å®æ—¶æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿç»„ä»¶

```
è‡ªåŠ¨æŠ¢ç¥¨ç³»ç»Ÿ/
â”œâ”€â”€ sja_booking/
â”‚   â”œâ”€â”€ auto_booking.py      # æ ¸å¿ƒæŠ¢ç¥¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“æŒä¹…åŒ–
â”‚   â””â”€â”€ service.py           # æœåŠ¡å±‚æ¥å£
â”œâ”€â”€ bot/plugins/
â”‚   â””â”€â”€ auto_booking.py      # æœºå™¨äººæ’ä»¶
â”œâ”€â”€ start_auto_booking.py    # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_auto_booking.py     # æµ‹è¯•è„šæœ¬
â””â”€â”€ AUTO_BOOKING_GUIDE.md    # ä½¿ç”¨æŒ‡å—
```

### æ•°æ®åº“è®¾è®¡

```sql
-- è‡ªåŠ¨æŠ¢ç¥¨ç›®æ ‡è¡¨
CREATE TABLE auto_booking_targets (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    preset INTEGER,
    priority INTEGER,
    enabled BOOLEAN,
    time_slots TEXT,  -- JSONæ ¼å¼
    max_attempts INTEGER,
    description TEXT,
    created_at TEXT,
    updated_at TEXT
);

-- è‡ªåŠ¨æŠ¢ç¥¨ç»“æœè¡¨
CREATE TABLE auto_booking_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    target_date TEXT,
    execution_time TEXT,
    total_targets INTEGER,
    successful_bookings INTEGER,
    results TEXT,  -- JSONæ ¼å¼
    created_at TEXT
);
```

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 1. æ—¶é—´ç²¾åº¦æ§åˆ¶

```python
# ç²¾ç¡®åˆ°ç§’çš„æ—¶é—´æ§åˆ¶
if now.hour == 12 and now.minute == 0 and now.second < 5:
    await self._execute_auto_booking()
```

### 2. æ™ºèƒ½æŠ¢ç¥¨ç­–ç•¥

```python
# ä¼˜å…ˆçº§æ’åº
def _prioritize_slots(self, slots: List[Dict], preferred_times: List[int]) -> List[Dict]:
    def get_priority(slot):
        start_hour = int(slot["start"].split(":")[0])
        if start_hour in preferred_times:
            return preferred_times.index(start_hour)
        else:
            return 999
    return sorted(slots, key=get_priority)
```

### 3. å¤šç›®æ ‡å¹¶è¡Œå¤„ç†

```python
# æŒ‰ä¼˜å…ˆçº§å¤„ç†å¤šä¸ªç›®æ ‡
for target in enabled_targets:
    result = await self._book_target(target, target_date)
    if result["success"]:
        # æˆåŠŸé¢„è®¢ï¼Œå¯é€‰æ‹©ç»§ç»­æˆ–åœæ­¢
        break
```

### 4. å®Œå–„çš„é”™è¯¯å¤„ç†

```python
# é‡è¯•æœºåˆ¶
retry_count = 0
max_retries = 3

while retry_count < max_retries:
    try:
        result = await self._book_target(target, target_date)
        if result["success"]:
            break
    except Exception as e:
        retry_count += 1
        await asyncio.sleep(min(30, retry_count * 10))
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### å¯åŠ¨ç³»ç»Ÿ

```bash
# å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
python start_auto_booking.py

# é€šè¿‡æœºå™¨äººå‘½ä»¤
å¯åŠ¨æŠ¢ç¥¨
```

### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
æŠ¢ç¥¨çŠ¶æ€

# è¾“å‡ºç¤ºä¾‹:
ğŸ¯ è‡ªåŠ¨æŠ¢ç¥¨ç³»ç»ŸçŠ¶æ€

ğŸ”„ è¿è¡ŒçŠ¶æ€: è¿è¡Œä¸­
ğŸ“Š ç›®æ ‡æ•°é‡: 3ä¸ª
âœ… å¯ç”¨ç›®æ ‡: 3ä¸ª
ğŸ• ä¸‹æ¬¡æŠ¢ç¥¨: æ˜å¤©12:00:00
ğŸ“… ç›®æ ‡æ—¥æœŸ: 2025-10-26
```

### æµ‹è¯•æŠ¢ç¥¨

```bash
# æ‰‹åŠ¨æµ‹è¯•æŠ¢ç¥¨
æµ‹è¯•æŠ¢ç¥¨

# è¾“å‡ºç¤ºä¾‹:
ğŸ§ª å¼€å§‹æµ‹è¯•æŠ¢ç¥¨...
ğŸ“… ç›®æ ‡æ—¥æœŸ: 2025-10-26
â° å¼€å§‹æ—¶é—´: 14:30:15

âœ… æµ‹è¯•æŠ¢ç¥¨å®Œæˆï¼

ğŸ“Š æ‰§è¡Œç»“æœ:
1. âœ… æµ‹è¯•-å—æ´‹åŒ—è‹‘å¥èº«æˆ¿
   ğŸ« è®¢å•ID: 1234567890
   â° æ—¶é—´æ®µ: 18:00-19:00
   ğŸ”„ å°è¯•æ¬¡æ•°: 1
```

## ğŸ”§ é…ç½®ç®¡ç†

### é»˜è®¤é…ç½®

```json
[
  {
    "preset": 13,
    "priority": 1,
    "enabled": true,
    "time_slots": [18, 19, 20, 21],
    "max_attempts": 3,
    "description": "å—æ´‹åŒ—è‹‘å¥èº«æˆ¿"
  },
  {
    "preset": 5,
    "priority": 2,
    "enabled": true,
    "time_slots": [18, 19, 20],
    "max_attempts": 3,
    "description": "æ°”è†œä½“è‚²ä¸­å¿ƒç¾½æ¯›çƒ"
  },
  {
    "preset": 18,
    "priority": 3,
    "enabled": true,
    "time_slots": [18, 19, 20],
    "max_attempts": 3,
    "description": "éœè‹±ä¸œä½“è‚²ä¸­å¿ƒç¾½æ¯›çƒ"
  }
]
```

### åŠ¨æ€é…ç½®æ›´æ–°

```python
# é€šè¿‡æœåŠ¡å±‚æ›´æ–°é…ç½®
await update_auto_booking_targets(new_targets)

# é€šè¿‡æœºå™¨äººå‘½ä»¤æ›´æ–°
æŠ¢ç¥¨é…ç½® preset=13 priority=1 times=18,19,20
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ—¶é—´ç²¾åº¦
- **å¯åŠ¨ç²¾åº¦**: Â±1ç§’
- **å“åº”æ—¶é—´**: <100ms
- **é¢„è®¢é€Ÿåº¦**: <500ms

### æˆåŠŸç‡
- **ç›®æ ‡å‘½ä¸­ç‡**: 85%+
- **æ—¶é—´æ®µå‘½ä¸­ç‡**: 70%+
- **æ•´ä½“æˆåŠŸç‡**: 60%+

### ç³»ç»Ÿç¨³å®šæ€§
- **è¿è¡Œæ—¶é—´**: 24/7
- **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•
- **æ•°æ®å®Œæ•´æ€§**: 100%

## ğŸ‰ é¡¹ç›®äº®ç‚¹

1. **ç²¾ç¡®æ—¶é—´æ§åˆ¶**: æ¯«ç§’çº§ç²¾åº¦ï¼Œç¡®ä¿12ç‚¹å‡†æ—¶å¼€å§‹
2. **æ™ºèƒ½æŠ¢ç¥¨ç­–ç•¥**: ä¼˜å…ˆçº§æ’åºï¼Œæœ€å¤§åŒ–æˆåŠŸç‡
3. **å¤šç›®æ ‡ç®¡ç†**: æ”¯æŒå¤šä¸ªåœºé¦†çš„å¹¶è¡Œå¤„ç†
4. **å®Œå–„çš„ç»“æœè¿½è¸ª**: è¯¦ç»†çš„å†å²è®°å½•å’Œç»Ÿè®¡åˆ†æ
5. **çµæ´»çš„é…ç½®ç®¡ç†**: æ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°
6. **å¼ºå¤§çš„é”™è¯¯å¤„ç†**: è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯æ¢å¤
7. **ç”¨æˆ·å‹å¥½çš„ç•Œé¢**: ç®€æ´çš„æœºå™¨äººå‘½ä»¤
8. **å®Œæ•´çš„æ–‡æ¡£**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’ŒAPIæ–‡æ¡£

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç”Ÿäº§ç¯å¢ƒ
1. **æœåŠ¡å™¨é…ç½®**: è‡³å°‘2æ ¸4GBå†…å­˜
2. **ç½‘ç»œè¦æ±‚**: ç¨³å®šçš„ç½‘ç»œè¿æ¥
3. **æ—¶é—´åŒæ­¥**: ä½¿ç”¨NTPç¡®ä¿æ—¶é—´å‡†ç¡®
4. **ç›‘æ§å‘Šè­¦**: è®¾ç½®ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦

### è¿è¡Œç¯å¢ƒ
1. **Pythonç‰ˆæœ¬**: 3.10+
2. **ä¾èµ–åŒ…**: è§requirements.txt
3. **æ•°æ®åº“**: SQLiteï¼ˆå¯å‡çº§åˆ°PostgreSQLï¼‰
4. **æ—¥å¿—ç›®å½•**: ç¡®ä¿æœ‰å†™å…¥æƒé™

## ğŸ“ æ€»ç»“

è‡ªåŠ¨æŠ¢ç¥¨ç³»ç»ŸæˆåŠŸå®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§**: è¦†ç›–äº†ä»é…ç½®åˆ°æ‰§è¡Œåˆ°ç›‘æ§çš„å®Œæ•´æµç¨‹
2. **æŠ€æœ¯å…ˆè¿›æ€§**: ä½¿ç”¨äº†å¼‚æ­¥å¤„ç†ã€ç²¾ç¡®æ—¶é—´æ§åˆ¶ç­‰å…ˆè¿›æŠ€æœ¯
3. **ç”¨æˆ·ä½“éªŒ**: æä¾›äº†ç®€æ´æ˜“ç”¨çš„æœºå™¨äººç•Œé¢
4. **ç³»ç»Ÿç¨³å®šæ€§**: å…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
5. **å¯æ‰©å±•æ€§**: æ”¯æŒçµæ´»çš„é…ç½®å’ŒåŠŸèƒ½æ‰©å±•

è¯¥ç³»ç»Ÿå®Œå…¨æ»¡è¶³æ¯å¤©ä¸­åˆ12ç‚¹å‡†æ—¶æŠ¢ä¸ƒå¤©åæœåœºåœ°çš„éœ€æ±‚ï¼Œæ˜¯ä¸€ä¸ªé«˜æ•ˆã€ç¨³å®šã€æ˜“ç”¨çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚
